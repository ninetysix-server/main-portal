<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>96Studios - Business Services & Income Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        /* Your existing CSS styles remain exactly the same */
        :root {
            --primary-color: #004370;
            --primary-dark: #106ebe;
            --light-gray: #f3f2f1;
            --border-gray: #d2d0ce;
            --text-dark: #323130;
            --text-light: #605e5c;
            --success-color: #107c10;
            --warning-color: #d83b01;
            --error-color: #a80000;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #faf9f8;
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* Header Styles */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo i {
            font-size: 24px;
        }
        
        .logo h1 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .business-info {
            font-size: 14px;
            text-align: right;
        }
        
        .auth-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--primary-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Navigation Styles */
        nav {
            width: 220px;
            background-color: white;
            border-right: 1px solid var(--border-gray);
            padding: 16px 0;
            flex-shrink: 0;
            overflow-y: auto;
        }
        
        .nav-item {
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .nav-item:hover {
            background-color: var(--light-gray);
        }
        
        .nav-item.active {
            background-color: var(--light-gray);
            border-left: 3px solid var(--primary-color);
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
        }
        
        /* Main Content Styles */
        main {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }
        
        .section-title {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title h2 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--border-gray);
        }
        
        .btn-outline:hover {
            background-color: var(--light-gray);
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            opacity: 0.9;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            opacity: 0.9;
        }
        
        /* Form Styles */
        .form-container {
            background-color: white;
            border: 1px solid var(--border-gray);
            border-radius: 4px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-light);
        }
        
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-gray);
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border: 1px solid var(--border-gray);
        }
        
        .data-table th,
        .data-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-gray);
        }
        
        .data-table th {
            background-color: var(--light-gray);
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .data-table tr:hover {
            background-color: rgba(0, 120, 212, 0.05);
        }
        
        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .summary-card {
            background-color: white;
            border: 1px solid var(--border-gray);
            border-radius: 4px;
            padding: 16px;
        }
        
        .summary-card h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        
        .summary-card .value {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            background-color: var(--light-gray);
        }
        
        .login-box {
            background-color: rgba(255, 255, 255, 0);
            border-radius: 8px;
            padding: 40px;
            width: 400px;
            text-align: center;
        }
        
        .login-box h2 {
            margin-bottom: 24px;
            color: var(--primary-color);
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: #4285F4;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
        }
        
        .login-btn:hover {
            background-color: #357ae8;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .app-container {
                flex-direction: column;
            }
            
            nav {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border-gray);
                padding: 8px 0;
                display: flex;
                overflow-x: auto;
            }
            
            .nav-item {
                padding: 12px 16px;
                white-space: nowrap;
            }
            
            .business-info {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
        }
        
        /* Print Styles */
        @media print {
            nav, .auth-section, .action-buttons {
                display: none !important;
            }
            
            .form-container {
                border: none;
                padding: 0;
            }
            
            .data-table {
                page-break-inside: avoid;
            }
        }
        
        /* Status Messages */
        .status-message {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 16px;
            display: none;
        }
        
        .status-success {
            background-color: #dff6dd;
            color: var(--success-color);
            border: 1px solid #107c10;
        }
        
        .status-error {
            background-color: #fde7e9;
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--light-gray);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
    </style>
</head>
<body>
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h2>Portal@96Studios</h2>
            <p>Sign in with your Google account to access the admin panel</p>
            <button id="googleSignIn" class="login-btn">
                <i class="fab fa-google"></i> Sign in with Google
            </button>
            <div class="business-info" style="text-align: center; margin-top: 30px;">
                <p><i class="fas fa-phone"></i> (+27) 817 925 033</p>
                <p><i class="fas fa-envelope"></i> Support@96studios.co.za</p>
                <p><i class="fas fa-globe"></i> www.96studios.co.za</p>
            </div>
        </div>
    </div>

    <div id="appContainer" style="display: none; flex-direction: column; height: 100vh;">
        <header>
            <div class="logo">
                <i class="fas fa-table"></i>
                <h1>96Studios - Business Portal</h1>
            </div>
            <div class="business-info">
                <p><i class="fas fa-phone"></i> (+27) 817 925 033</p>
                <p><i class="fas fa-envelope"></i> Support@96studios.co.za</p>
            </div>
            <div class="auth-section">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <span id="userName">Admin User</span>
                </div>
                <button id="signOutButton" class="btn btn-outline">
                    <i class="fas fa-sign-out-alt"></i> Sign Out
                </button>
            </div>
        </header>
        
        <div class="app-container">
            <nav>
                <div class="nav-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" data-section="clients">
                    <i class="fas fa-user-circle"></i>
                    <span>Client Profiles</span>
                </div>
                <div class="nav-item" data-section="monthly">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Monthly View</span>
                </div>
                <div class="nav-item" data-section="yearly">
                    <i class="fas fa-chart-line"></i>
                    <span>Yearly Overview</span>
                </div>
                <div class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
            </nav>
            
            <main>
                <div id="statusMessage" class="status-message"></div>
                
                <div id="dashboardSection">
                    <div class="section-title">
                        <h2>Dashboard Overview</h2>
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="refreshData">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="summary-cards">
                        <div class="summary-card">
                            <h3>Monthly Services</h3>
                            <div class="value" id="monthlyServices">0</div>
                        </div>
                        <div class="summary-card">
                            <h3>Monthly Income (ZAR)</h3>
                            <div class="value" id="monthlyIncome">R 0.00</div>
                        </div>
                        <div class="summary-card">
                            <h3>Average per Service (ZAR)</h3>
                            <div class="value" id="averageService">R 0.00</div>
                        </div>
                        <div class="summary-card">
                            <h3>Total Discounts (ZAR)</h3>
                            <div class="value" id="monthlyDiscounts">R 0.00</div>
                        </div>
                    </div>
                    
                    <div class="section-title">
                        <h2>Recent Service Entries</h2>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Client ID</th>
                                <th>Company/Name</th>
                                <th>Service</th>
                                <th>Amount (ZAR)</th>
                                <th>Discount</th>
                                <th>Net Amount (ZAR)</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="recentServices">
                            <tr>
                                <td colspan="7" style="text-align: center;">No data available</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div id="clientsSection" style="display: none;">
                    <div class="section-title">
                        <h2>Client Profile Management</h2>
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="printClient">
                                <i class="fas fa-print"></i> Print
                            </button>
                            <button class="btn btn-success" id="exportClient">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-container">
                        <h3>Add New Client/Service</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="clientId">Client ID *</label>
                                <input type="text" id="clientId" class="form-control" placeholder="CL-001">
                            </div>
                            <div class="form-group">
                                <label for="companyName">Company Name/Full Name *</label>
                                <input type="text" id="companyName" class="form-control" placeholder="ABC Corporation">
                            </div>
                            <div class="form-group">
                                <label for="email">Email *</label>
                                <input type="email" id="email" class="form-control" placeholder="client@example.com">
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone *</label>
                                <input type="tel" id="phone" class="form-control" placeholder="(+27) 123 456 7890">
                            </div>
                            <div class="form-group">
                                <label for="serviceOffered">Service Offered *</label>
                                <input type="text" id="serviceOffered" class="form-control" placeholder="Web Development">
                            </div>
                            <div class="form-group">
                                <label for="serviceAmount">Service Amount (ZAR) *</label>
                                <input type="number" id="serviceAmount" class="form-control" placeholder="500.00" step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="discountAmount">Discount Amount (ZAR)</label>
                                <input type="number" id="discountAmount" class="form-control" placeholder="50.00" step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="discountPercent">Discount (%)</label>
                                <input type="number" id="discountPercent" class="form-control" placeholder="10" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-group">
                                    <input type="checkbox" id="saleOffer">
                                    <span>Sale Offer</span>
                                </label>
                            </div>
                        </div>
                        <div class="action-buttons" style="margin-top: 16px;">
                            <button class="btn btn-primary" id="saveClient">
                                <i class="fas fa-save"></i> Save Entry
                            </button>
                            <button class="btn btn-outline" id="clearForm">
                                <i class="fas fa-times"></i> Clear Form
                            </button>
                        </div>
                    </div>
                    
                    <div class="section-title">
                        <h2>Client Records</h2>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Client ID</th>
                                <th>Company/Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Service</th>
                                <th>Amount (ZAR)</th>
                                <th>Discount</th>
                                <th>Net Amount (ZAR)</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="clientRecords">
                            <tr>
                                <td colspan="10" style="text-align: center;">No client records found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div id="monthlySection" style="display: none;">
                    <div class="section-title">
                        <h2>Monthly Summary - <span id="currentMonth">August 2023</span></h2>
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="printMonthly">
                                <i class="fas fa-print"></i> Print Monthly Report
                            </button>
                        </div>
                    </div>
                    
                    <div class="summary-cards">
                        <div class="summary-card">
                            <h3>Total Services</h3>
                            <div class="value" id="monthServices">0</div>
                        </div>
                        <div class="summary-card">
                            <h3>Total Income (ZAR)</h3>
                            <div class="value" id="monthIncome">R 0.00</div>
                        </div>
                        <div class="summary-card">
                            <h3>Average per Service (ZAR)</h3>
                            <div class="value" id="monthAverage">R 0.00</div>
                        </div>
                        <div class="summary-card">
                            <h3>Total Discounts (ZAR)</h3>
                            <div class="value" id="monthDiscounts">R 0.00</div>
                        </div>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Service</th>
                                <th>Amount (ZAR)</th>
                                <th>Discount</th>
                                <th>Net Amount (ZAR)</th>
                            </tr>
                        </thead>
                        <tbody id="monthlyRecords">
                            <tr>
                                <td colspan="6" style="text-align: center;">No monthly records found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div id="yearlySection" style="display: none;">
                    <div class="section-title">
                        <h2>Yearly Overview - <span id="currentYear">2023</span></h2>
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="printYearly">
                                <i class="fas fa-print"></i> Print Yearly Report
                            </button>
                            <button class="btn btn-warning" id="clearYearButton">
                                <i class="fas fa-trash"></i> Clear Year
                            </button>
                        </div>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Services Provided</th>
                                <th>Total Income (ZAR)</th>
                                <th>Discounts (ZAR)</th>
                                <th>Net Income (ZAR)</th>
                            </tr>
                        </thead>
                        <tbody id="yearlyRecords">
                            <tr>
                                <td colspan="5" style="text-align: center;">No yearly records found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBnrsgE_V2Gpwia-qHXbevOHUPSwsvtzys",
            authDomain: "databse-b6b09.firebaseapp.com",
            projectId: "databse-b6b09",
            storageBucket: "databse-b6b09.firebasestorage.app",
            messagingSenderId: "668647439207",
            appId: "1:668647439207:web:c50c3813e6d2de02b7cdc2"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const appContainer = document.getElementById('appContainer');
        const statusMessage = document.getElementById('statusMessage');
        const googleSignInBtn = document.getElementById('googleSignIn');
        const signOutButton = document.getElementById('signOutButton');
        const navItems = document.querySelectorAll('.nav-item');
        const sections = ['dashboardSection', 'clientsSection', 'monthlySection', 'yearlySection'];
        const saveClientBtn = document.getElementById('saveClient');
        const clearFormBtn = document.getElementById('clearForm');
        const refreshDataBtn = document.getElementById('refreshData');
        const clearYearButton = document.getElementById('clearYearButton');
        
        // Form Elements
        const clientId = document.getElementById('clientId');
        const companyName = document.getElementById('companyName');
        const email = document.getElementById('email');
        const phone = document.getElementById('phone');
        const serviceOffered = document.getElementById('serviceOffered');
        const serviceAmount = document.getElementById('serviceAmount');
        const discountAmount = document.getElementById('discountAmount');
        const discountPercent = document.getElementById('discountPercent');
        const saleOffer = document.getElementById('saleOffer');
        
        // Admin email (replace with your admin email)
        const ADMIN_EMAIL = "96studios.web@gmail.com";
        
        // Real-time listeners
        let clientsListener = null;
        let monthlyListener = null;
        
        // Firebase Auth State Listener
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Check if user is admin
                if (user.email === ADMIN_EMAIL) {
                    // User is signed in and is admin
                    loginPage.style.display = 'none';
                    appContainer.style.display = 'flex';
                    document.getElementById('userName').textContent = user.displayName || user.email;
                    document.getElementById('userAvatar').textContent = user.displayName ? 
                        user.displayName.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase();
                    showStatus('Successfully signed in as admin!', 'success');
                    
                    // Set up real-time listeners
                    setupRealTimeListeners();
                } else {
                    // User is signed in but not admin
                    showStatus('Access denied. Only admin users can access this page.', 'error');
                    auth.signOut();
                }
            } else {
                // User is signed out
                loginPage.style.display = 'flex';
                appContainer.style.display = 'none';
                
                // Remove listeners when signed out
                if (clientsListener) {
                    clientsListener();
                    clientsListener = null;
                }
                if (monthlyListener) {
                    monthlyListener();
                    monthlyListener = null;
                }
            }
        });
        
        // Set up real-time Firestore listeners
        function setupRealTimeListeners() {
            // Set up clients listener
            clientsListener = db.collection('clients')
                .orderBy('timestamp', 'desc')
                .onSnapshot((querySnapshot) => {
                    loadClientData(querySnapshot);
                    loadDashboardData();
                }, (error) => {
                    console.error('Clients listener error:', error);
                    showStatus('Error loading client data: ' + error.message, 'error');
                });
            
            // Set up monthly data listener
            const now = new Date();
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            
            monthlyListener = db.collection('clients')
                .where('date', '>=', startOfMonth.toISOString())
                .where('date', '<=', endOfMonth.toISOString())
                .onSnapshot((querySnapshot) => {
                    loadMonthlyData(querySnapshot);
                }, (error) => {
                    console.error('Monthly listener error:', error);
                    showStatus('Error loading monthly data: ' + error.message, 'error');
                });
        }
        
        // Google Sign In
        googleSignInBtn.addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    // Signed in successfully
                })
                .catch((error) => {
                    showStatus('Error signing in: ' + error.message, 'error');
                });
        });
        
        // Sign Out
        signOutButton.addEventListener('click', () => {
            auth.signOut()
                .then(() => {
                    showStatus('Successfully signed out', 'success');
                })
                .catch((error) => {
                    showStatus('Error signing out: ' + error.message, 'error');
                });
        });
        
        // Show status message
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message';
            statusMessage.classList.add(type === 'success' ? 'status-success' : 'status-error');
            statusMessage.style.display = 'block';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }
        
        // Navigation
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                const section = item.getAttribute('data-section');
                
                // Update active nav item
                navItems.forEach(navItem => navItem.classList.remove('active'));
                item.classList.add('active');
                
                // Show the corresponding section
                sections.forEach(s => {
                    document.getElementById(s).style.display = 'none';
                });
                
                document.getElementById(section + 'Section').style.display = 'block';
                
                // Load data for the section if needed
                if (section === 'dashboard') {
                    loadDashboardData();
                } else if (section === 'yearly') {
                    loadYearlyData();
                }
            });
        });
        
        // Discount calculation
        discountAmount.addEventListener('input', calculateDiscountPercent);
        discountPercent.addEventListener('input', calculateDiscountAmount);
        serviceAmount.addEventListener('input', syncDiscountCalculations);
        
        function calculateDiscountPercent() {
            const serviceValue = parseFloat(serviceAmount.value) || 0;
            const discountValue = parseFloat(discountAmount.value) || 0;
            
            if (serviceValue > 0) {
                const percent = (discountValue / serviceValue) * 100;
                discountPercent.value = percent.toFixed(2);
            }
        }
        
        function calculateDiscountAmount() {
            const serviceValue = parseFloat(serviceAmount.value) || 0;
            const percentValue = parseFloat(discountPercent.value) || 0;
            
            const discount = serviceValue * (percentValue / 100);
            discountAmount.value = discount.toFixed(2);
        }
        
        function syncDiscountCalculations() {
            if (discountPercent.value && parseFloat(discountPercent.value) > 0) {
                calculateDiscountAmount();
            } else if (discountAmount.value && parseFloat(discountAmount.value) > 0) {
                calculateDiscountPercent();
            }
        }
        
        // Clear form
        clearFormBtn.addEventListener('click', () => {
            clientId.value = '';
            companyName.value = '';
            email.value = '';
            phone.value = '';
            serviceOffered.value = '';
            serviceAmount.value = '';
            discountAmount.value = '';
            discountPercent.value = '';
            saleOffer.checked = false;
        });
        
        // Save client data to Firestore
        saveClientBtn.addEventListener('click', async () => {
            // Basic validation
            if (!clientId.value || !companyName.value || !email.value || !phone.value || 
                !serviceOffered.value || !serviceAmount.value) {
                showStatus('Please fill in all required fields', 'error');
                return;
            }
            
            try {
                const netAmount = (parseFloat(serviceAmount.value) - (parseFloat(discountAmount.value) || 0));
                
                const clientData = {
                    clientId: clientId.value,
                    companyName: companyName.value,
                    email: email.value,
                    phone: phone.value,
                    serviceOffered: serviceOffered.value,
                    serviceAmount: parseFloat(serviceAmount.value),
                    discountAmount: parseFloat(discountAmount.value) || 0,
                    discountPercent: parseFloat(discountPercent.value) || 0,
                    saleOffer: saleOffer.checked,
                    netAmount: netAmount,
                    date: new Date().toISOString(),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('clients').add(clientData);
                showStatus('Client data saved successfully!', 'success');
                
                // Clear form
                clearFormBtn.click();
            } catch (error) {
                showStatus('Error saving data: ' + error.message, 'error');
            }
        });
        
        // Load client data from Firestore
        async function loadClientData(querySnapshot = null) {
            try {
                if (!querySnapshot) {
                    querySnapshot = await db.collection('clients')
                        .orderBy('timestamp', 'desc')
                        .get();
                }
                    
                const clientRecords = document.getElementById('clientRecords');
                clientRecords.innerHTML = '';
                
                if (querySnapshot.empty) {
                    clientRecords.innerHTML = '<tr><td colspan="10" style="text-align: center;">No client records found</td></tr>';
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const date = data.date ? new Date(data.date) : new Date();
                    
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${data.clientId}</td>
                        <td>${data.companyName}</td>
                        <td>${data.email}</td>
                        <td>${data.phone}</td>
                        <td>${data.serviceOffered}</td>
                        <td>R ${data.serviceAmount.toFixed(2)}</td>
                        <td>R ${data.discountAmount.toFixed(2)} (${data.discountPercent.toFixed(2)}%)</td>
                        <td>R ${data.netAmount.toFixed(2)}</td>
                        <td>${date.toLocaleDateString()}</td>
                        <td>
                            <i class="fas fa-edit" style="color: var(--primary-color); cursor: pointer;"></i>
                            <i class="fas fa-trash" style="color: var(--warning-color); cursor: pointer; margin-left: 12px;" data-id="${doc.id}"></i>
                        </td>
                    `;
                    
                    // Add delete functionality
                    row.querySelector('.fa-trash').addEventListener('click', () => {
                        deleteClient(doc.id);
                    });
                    
                    clientRecords.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading data:', error);
                showStatus('Error loading client data: ' + error.message, 'error');
            }
        }
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                const now = new Date();
                const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                
                const querySnapshot = await db.collection('clients')
                    .where('date', '>=', startOfMonth.toISOString())
                    .where('date', '<=', endOfMonth.toISOString())
                    .get();
                    
                let totalServices = 0;
                let totalIncome = 0;
                let totalDiscounts = 0;
                const recentServices = document.getElementById('recentServices');
                recentServices.innerHTML = '';
                
                if (querySnapshot.empty) {
                    recentServices.innerHTML = '<tr><td colspan="7" style="text-align: center;">No recent services found</td></tr>';
                    
                    // Update summary cards
                    document.getElementById('monthlyServices').textContent = '0';
                    document.getElementById('monthlyIncome').textContent = 'R 0.00';
                    document.getElementById('averageService').textContent = 'R 0.00';
                    document.getElementById('monthlyDiscounts').textContent = 'R 0.00';
                    
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const date = data.date ? new Date(data.date) : new Date();
                    
                    totalServices++;
                    totalIncome += data.netAmount;
                    totalDiscounts += data.discountAmount;
                    
                    // Add to recent services table
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${data.clientId}</td>
                        <td>${data.companyName}</td>
                        <td>${data.serviceOffered}</td>
                        <td>R ${data.serviceAmount.toFixed(2)}</td>
                        <td>R ${data.discountAmount.toFixed(2)} (${data.discountPercent.toFixed(2)}%)</td>
                        <td>R ${data.netAmount.toFixed(2)}</td>
                        <td>${date.toLocaleDateString()}</td>
                    `;
                    recentServices.appendChild(row);
                });
                
                // Update summary cards
                document.getElementById('monthlyServices').textContent = totalServices;
                document.getElementById('monthlyIncome').textContent = `R ${totalIncome.toFixed(2)}`;
                document.getElementById('averageService').textContent = `R ${(totalIncome / totalServices).toFixed(2)}`;
                document.getElementById('monthlyDiscounts').textContent = `R ${totalDiscounts.toFixed(2)}`;
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showStatus('Error loading dashboard data: ' + error.message, 'error');
            }
        }
        
        // Load monthly data
        async function loadMonthlyData(querySnapshot = null) {
            try {
                if (!querySnapshot) {
                    const now = new Date();
                    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                    const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    
                    querySnapshot = await db.collection('clients')
                        .where('date', '>=', startOfMonth.toISOString())
                        .where('date', '<=', endOfMonth.toISOString())
                        .orderBy('date', 'desc')
                        .get();
                }
                
                // Update month name
                const now = new Date();
                const monthNames = ["January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"
                ];
                document.getElementById('currentMonth').textContent = `${monthNames[now.getMonth()]} ${now.getFullYear()}`;
                
                let totalServices = 0;
                let totalIncome = 0;
                let totalDiscounts = 0;
                const monthlyRecords = document.getElementById('monthlyRecords');
                monthlyRecords.innerHTML = '';
                
                if (querySnapshot.empty) {
                    monthlyRecords.innerHTML = '<tr><td colspan="6" style="text-align: center;">No monthly records found</td></tr>';
                    
                    // Update summary cards
                    document.getElementById('monthServices').textContent = '0';
                    document.getElementById('monthIncome').textContent = 'R 0.00';
                    document.getElementById('monthAverage').textContent = 'R 0.00';
                    document.getElementById('monthDiscounts').textContent = 'R 0.00';
                    
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const date = data.date ? new Date(data.date) : new Date();
                    
                    totalServices++;
                    totalIncome += data.netAmount;
                    totalDiscounts += data.discountAmount;
                    
                    // Add to monthly records table
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${date.toLocaleDateString()}</td>
                        <td>${data.companyName}</td>
                        <td>${data.serviceOffered}</td>
                        <td>R ${data.serviceAmount.toFixed(2)}</td>
                        <td>R ${data.discountAmount.toFixed(2)} (${data.discountPercent.toFixed(2)}%)</td>
                        <td>R ${data.netAmount.toFixed(2)}</td>
                    `;
                    monthlyRecords.appendChild(row);
                });
                
                // Update summary cards
                document.getElementById('monthServices').textContent = totalServices;
                document.getElementById('monthIncome').textContent = `R ${totalIncome.toFixed(2)}`;
                document.getElementById('monthAverage').textContent = `R ${(totalIncome / totalServices).toFixed(2)}`;
                document.getElementById('monthDiscounts').textContent = `R ${totalDiscounts.toFixed(2)}`;
            } catch (error) {
                console.error('Error loading monthly data:', error);
                showStatus('Error loading monthly data: ' + error.message, 'error');
            }
        }
        
        // Load yearly data
        async function loadYearlyData() {
            try {
                const currentYear = new Date().getFullYear();
                document.getElementById('currentYear').textContent = currentYear;
                
                const startOfYear = new Date(currentYear, 0, 1);
                const endOfYear = new Date(currentYear, 11, 31);
                
                const querySnapshot = await db.collection('clients')
                    .where('date', '>=', startOfYear.toISOString())
                    .where('date', '<=', endOfYear.toISOString())
                    .get();
                
                const yearlyRecords = document.getElementById('yearlyRecords');
                yearlyRecords.innerHTML = '';
                
                if (querySnapshot.empty) {
                    yearlyRecords.innerHTML = '<tr><td colspan="5" style="text-align: center;">No yearly records found</td></tr>';
                    return;
                }
                
                // Group data by month
                const monthlyData = {};
                const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                    "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                ];
                
                // Initialize monthly data
                for (let i = 0; i < 12; i++) {
                    monthlyData[i] = {
                        services: 0,
                        income: 0,
                        discounts: 0,
                        netIncome: 0
                    };
                }
                
                // Process each document
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const date = data.date ? new Date(data.date) : new Date();
                    const month = date.getMonth();
                    
                    monthlyData[month].services += 1;
                    monthlyData[month].income += data.serviceAmount;
                    monthlyData[month].discounts += data.discountAmount;
                    monthlyData[month].netIncome += data.netAmount;
                });
                
                // Add rows to table
                for (let i = 0; i < 12; i++) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${monthNames[i]}</td>
                        <td>${monthlyData[i].services}</td>
                        <td>R ${monthlyData[i].income.toFixed(2)}</td>
                        <td>R ${monthlyData[i].discounts.toFixed(2)}</td>
                        <td>R ${monthlyData[i].netIncome.toFixed(2)}</td>
                    `;
                    yearlyRecords.appendChild(row);
                }
            } catch (error) {
                console.error('Error loading yearly data:', error);
                showStatus('Error loading yearly data: ' + error.message, 'error');
            }
        }
        
        // Delete client record
        async function deleteClient(id) {
            if (confirm('Are you sure you want to delete this client record?')) {
                try {
                    await db.collection('clients').doc(id).delete();
                    showStatus('Client record deleted successfully!', 'success');
                } catch (error) {
                    showStatus('Error deleting record: ' + error.message, 'error');
                }
            }
        }
        
        // Refresh data
        refreshDataBtn.addEventListener('click', () => {
            loadClientData();
            loadDashboardData();
            loadMonthlyData();
            loadYearlyData();
            showStatus('Data refreshed', 'success');
        });
        
        // Clear year data
        clearYearButton.addEventListener('click', async () => {
            if (confirm('Are you sure you want to clear all data for this year? This action cannot be undone.')) {
                try {
                    const currentYear = new Date().getFullYear();
                    const startOfYear = new Date(currentYear, 0, 1);
                    const endOfYear = new Date(currentYear, 11, 31);
                    
                    // Get all documents for the current year
                    const querySnapshot = await db.collection('clients')
                        .where('date', '>=', startOfYear.toISOString())
                        .where('date', '<=', endOfYear.toISOString())
                        .get();
                    
                    // Delete each document
                    const batch = db.batch();
                    querySnapshot.forEach((doc) => {
                        batch.delete(doc.ref);
                    });
                    
                    await batch.commit();
                    showStatus('Yearly data cleared successfully!', 'success');
                } catch (error) {
                    showStatus('Error clearing yearly data: ' + error.message, 'error');
                }
            }
        });
        
        // Print functionality
        document.getElementById('printClient').addEventListener('click', () => {
            window.print();
        });
        
        document.getElementById('printMonthly').addEventListener('click', () => {
            window.print();
        });
        
        document.getElementById('printYearly').addEventListener('click', () => {
            window.print();
        });
        
        // Initialize the current month and year displays
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            document.getElementById('currentMonth').textContent = `${monthNames[now.getMonth()]} ${now.getFullYear()}`;
            document.getElementById('currentYear').textContent = now.getFullYear();
        });
    </script>
</body>
</html>